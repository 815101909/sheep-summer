<!-- pages/hoofprint/hoofprint.wxml -->
<!-- 背景层 -->
<view class="background-container {{themeClass}}">
  <image class="background-image" src="/assets/images/splash-bg.png" mode="aspectFill" lazy-load="true" />
</view>

<view class="trial-section book-style" wx:if="{{dailyTendernessItem}}">
  <view class="book-container">
    <view class="book-wrapper">
      <view class="ribbon-badge">
        <image class="ribbon-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTE3IDhDOCAxMCA1LjkgMTYuMTcgMy44MiAyMS4zNCA1LjY3IDIxLjk0IDguMzQgMjEuMjggOS4zMiAyMC4zMSAxMC4wNiAxOS41NyAxMS4yOSAxNy41NiAxMi40MyAxNS4wOSAxMy42MiAxMi41MiAxNC42OCAxMC4yNyAxNyA4Wk03IDE4Ljk5QzcuMjUgMTguNTQgOS4zNiAxMy4xNSAxNSAxMCAxMS4wOCAxMi4xOCA4Ljg2IDE2LjE5IDcgMTguOTlaIiBmaWxsPSIjZmZmZmZmIi8+PC9zdmc+" />
        <text class="ribbon-text">今日温柔</text>
      </view>
      <view class="book-spine"></view>
      <view class="book-cover">
        <image class="book-image" src="{{dailyTendernessItem.cover || '/assets/images/default-cover.png'}}" mode="aspectFill" lazy-load="true" />
      </view>
      <view class="book-pages-right"></view>
    </view>
  </view>
  </view>

<view class="top-carousel polaroid-style {{themeClass}}">
  <view class="carousel-inner">
    <block wx:if="{{todayGentleList.length > 0}}">
      <view wx:for="{{todayGentleList}}" wx:key="id"
            class="polaroid-card {{index === currentGentleIndex ? 'active' : ''}} {{index === (currentGentleIndex + 1) % todayGentleList.length ? 'next' : ''}} {{index === (currentGentleIndex - 1 + todayGentleList.length) % todayGentleList.length ? 'prev' : ''}}"
            bindtap="openArticleDetail"
            data-article="{{item}}"
            data-card-type="main"
            data-card-index="0">
        <view class="tag-badge">
          <view class="badge-icon gentle-icon">
            <image class="badge-svg" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlPSIjNWU1MDNmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTIgM2g2YTQgNCAwIDAgMSA0IDR2MTRhMyAzIDAgMCAwLTMtM0gyeiIgZmlsbD0iIzVlNTAzZiIvPjxwYXRoIGQ9Ik0yMiAzaC02YTQgNCAwIDAgMC00IDR2MTRhMyAzIDAgMCAxIDMtM0gyMnoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=" mode="aspectFit" />
          </view>
          <text class="badge-text">陪伴尝试</text>
        </view>
        <image class="card-bg" src="{{item.cover || '/assets/images/default-cover.png'}}" mode="aspectFill" />
        <view class="card-overlay"></view>
      </view>
    </block>
    <view wx:else class="empty-tip">暂无陪伴尝试</view>
  </view>
  <view class="nav-btn prev" catchtap="handlePrevSlide" wx:if="{{todayGentleList.length > 1}}">
    <text class="nav-arrow">{{'<'}}</text>
  </view>
  <view class="nav-btn next" catchtap="handleNextSlide" wx:if="{{todayGentleList.length > 1}}">
    <text class="nav-arrow">{{'>'}}</text>
  </view>
</view>

<!-- 筛选控件 -->
<view class="filter-container {{themeClass}}">
  <view class="filter-row">
    <!-- 日期部分 -->
    <view class="filter-item">
      <text class="filter-label">日期</text>
      <view class="filter-separator"></view>
      <view class="date-controls">
        <picker mode="date" value="{{selectedDate}}" bindchange="bindDateChange" class="date-picker">
          <view class="picker-display" bindtap="showDatePicker">
            <text class="picker-text">{{selectedDateText || '选择日期'}}</text>
          </view>
        </picker>
        <view class="all-date-btn" bindtap="selectAllDates">
          <text class="btn-text">全部</text>
        </view>
      </view>
    </view>

    <!-- 类型部分 -->
    <view class="filter-item">
      <text class="filter-label">类型</text>
      <view class="filter-separator"></view>
      <view class="dropdown-container">
        <view class="dropdown-trigger" bindtap="toggleTypeDropdown">
          <text class="dropdown-text">{{selectedTypeText || '选择类型'}}</text>
        </view>
        <view class="dropdown-list" wx:if="{{showTypeDropdown}}">
          <view wx:for="{{typeOptions}}" wx:key="*this" class="dropdown-item {{item === selectedType ? 'active' : ''}}" bindtap="selectType" data-type="{{item}}">
            {{item}}
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- 时间线容器 -->
<view class="timeline-container {{themeClass}}">
  <!-- 时间线主轴 -->
  <view class="timeline-axis"></view>

  <!-- 时间线节点 -->
  <view class="timeline-nodes">
    <view class="timeline-node" wx:for="{{displayFilteredTimelineData}}" wx:key="date">
      <view class="node-date">
        <image class="date-decoration" src="/assets/images/日期前小羊.png" mode="aspectFit" lazy-load="true" />
        <text class="date-text">{{item.date}}</text>
      </view>

      <view class="node-cards-wrapper">
        <view class="film-card small-card" wx:if="{{item.articles.length > 0}}" bindtap="openArticleDetail" data-article="{{item.articles[0]}}" data-date="{{item.date}}" data-card-type="small" data-card-index="1">
          <view class="film-texture"></view>
          <view class="card-cover">
          <image class="cover-image" src="{{item.articles[0].smallCover || item.articles[0].cover || ''}}" mode="aspectFill" lazy-load="true" />
            <view class="card-bar">
              <text class="card-bar-text">弹走烦恼，春暖花开</text>
            </view>
          </view>
        </view>

        <view class="film-card main-card" wx:if="{{item.articles.length > 0}}" bindtap="openArticleDetail" data-article="{{item.articles[0]}}" data-date="{{item.date}}" data-card-type="main" data-card-index="0">
          <view class="film-texture"></view>
          <view class="card-cover">
          <image class="cover-image" src="{{item.articles[0].cover || ''}}" mode="aspectFill" lazy-load="true" />
            <view class="card-bar">
              <text class="card-bar-text">{{item.articles[0].titleCn}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
