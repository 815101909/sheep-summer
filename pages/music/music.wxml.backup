<!--pages/music/music.wxml-->
<view class="container">
  <image class="bg-image" src="/assets/images/splash-bg.png" mode="aspectFill"></image>

  <!-- MP3æ’­æ”¾å™¨ä¸»ä½“ -->
  <view class="mp3-player">
    <!-- MP3å¤–å£³ -->
    <view class="mp3-body">
      <!-- å±å¹•åŒºåŸŸ -->
      <view class="mp3-screen">
        <view class="screen-content">
          <!-- æ­Œæ›²ä¿¡æ¯ -->
          <view class="song-info">
            <text class="song-title" style="font-size: {{fontSize === 'small' ? '32rpx' : fontSize === 'large' ? '42rpx' : '37rpx'}}; color: {{fontColor === 'black' ? '#000000' : fontColor === 'white' ? '#ffffff' : fontColor === 'green' ? '#00ff00' : fontColor === 'blue' ? '#0088ff' : fontColor === 'red' ? '#ff0000' : '#a0522d'}}; font-family: 'Courier, monospace'; font-weight: bold; image-rendering: pixelated; text-rendering: optimizeSpeed">{{currentSong.title || 'åˆå¤å°å¤œæ›²'}}</text>
            <text class="song-artist" style="font-size: {{fontSize === 'small' ? '20rpx' : fontSize === 'large' ? '28rpx' : '24rpx'}}; color: {{fontColor === 'black' ? '#000000' : fontColor === 'white' ? '#ffffff' : fontColor === 'green' ? '#00cc00' : fontColor === 'blue' ? '#0088ff' : fontColor === 'red' ? '#cc0000' : '#8b4513'}}; font-family: 'Courier, monospace'; image-rendering: pixelated; text-rendering: optimizeSpeed">{{currentSong.artist || 'å¤æ—¥éŸ³ä¹å®¶'}}</text>
          </view>

          <!-- æ­Œè¯æ˜¾ç¤ºåŒºåŸŸ -->
          <view class="lyrics-display">
            <view class="lyrics-line" wx:for="{{lyrics}}" wx:key="index" wx:if="{{index >= currentLyricsIndex - 2 && index <= currentLyricsIndex + 2}}">
              <text class="lyrics-text {{index === currentLyricsIndex ? 'current' : ''}}" style="font-size: {{index === currentLyricsIndex ? (fontSize === 'small' ? '26rpx' : fontSize === 'large' ? '32rpx' : '28rpx') : (fontSize === 'small' ? '22rpx' : fontSize === 'large' ? '28rpx' : '24rpx')}}; color: {{index === currentLyricsIndex ? (fontColor === 'black' ? '#000000' : fontColor === 'white' ? '#ffffff' : fontColor === 'green' ? '#00ff00' : fontColor === 'blue' ? '#0088ff' : fontColor === 'red' ? '#ff0000' : '#a0522d') : (fontColor === 'black' ? '#666666' : fontColor === 'white' ? '#888888' : fontColor === 'green' ? '#448866' : fontColor === 'blue' ? '#6688aa' : fontColor === 'red' ? '#884444' : '#654321')}}; font-family: 'Courier, monospace'; font-weight: bold; image-rendering: pixelated; text-rendering: optimizeSpeed">{{item.text}}</text>
            </view>
          </view>

          <!-- è¿›åº¦æ¡ -->
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{progress}}%"></view>
          </view>

          <!-- æ—¶é—´æ˜¾ç¤º -->
          <view class="time-display">
            <text class="current-time" style="color: {{fontColor === 'black' ? '#000000' : fontColor === 'white' ? '#ffffff' : fontColor === 'green' ? '#00ff00' : fontColor === 'blue' ? '#0088ff' : fontColor === 'red' ? '#ff0000' : '#a0522d'}}; font-family: 'Courier, monospace'; image-rendering: pixelated; text-rendering: optimizeSpeed">{{currentTime}}</text>
            <text class="total-time" style="color: {{fontColor === 'black' ? '#000000' : fontColor === 'white' ? '#ffffff' : fontColor === 'green' ? '#00ff00' : fontColor === 'blue' ? '#0088ff' : fontColor === 'red' ? '#ff0000' : '#a0522d'}}; font-family: 'Courier, monospace'; image-rendering: pixelated; text-rendering: optimizeSpeed">{{totalTime}}</text>
          </view>
        </view>
      </view>

      <!-- åŠŸèƒ½æ  -->
      <view class="function-bar">
        <text class="function-text {{activePanel === 'speed' ? 'active' : ''}}" bindtap="togglePanel" data-panel="speed">å€é€Ÿæœ—è¯»</text>
        <text class="function-text {{activePanel === 'fontSize' ? 'active' : ''}}" bindtap="togglePanel" data-panel="fontSize">å­—ä½“å¤§å°</text>
        <text class="function-text {{activePanel === 'fontColor' ? 'active' : ''}}" bindtap="togglePanel" data-panel="fontColor">å­—ä½“é¢œè‰²</text>
      </view>

      <!-- é€æ˜é®ç½©å±‚ -->
      <view wx:if="{{activePanel}}" class="overlay" catchtap="hidePanel"></view>

      <!-- å±•å¼€é¢æ¿ -->
      <view wx:if="{{activePanel}}" class="expand-panel visible" catchtap="">
        <!-- å€é€Ÿé€‰é¡¹ -->
        <view wx:if="{{activePanel === 'speed'}}" class="panel-content active">
          <view class="panel-header">é€‰æ‹©æ’­æ”¾å€é€Ÿ</view>
          <view class="option-grid">
            <view class="option-btn {{playbackRate === 0.5 ? 'selected' : ''}}" bindtap="setPlaybackRate" data-rate="0.5">
              <text class="option-text">0.5x</text>
            </view>
            <view class="option-btn {{playbackRate === 0.75 ? 'selected' : ''}}" bindtap="setPlaybackRate" data-rate="0.75">
              <text class="option-text">0.75x</text>
            </view>
            <view class="option-btn {{playbackRate === 1.0 ? 'selected' : ''}}" bindtap="setPlaybackRate" data-rate="1.0">
              <text class="option-text">1.0x</text>
            </view>
            <view class="option-btn {{playbackRate === 1.25 ? 'selected' : ''}}" bindtap="setPlaybackRate" data-rate="1.25">
              <text class="option-text">1.25x</text>
            </view>
            <view class="option-btn {{playbackRate === 1.5 ? 'selected' : ''}}" bindtap="setPlaybackRate" data-rate="1.5">
              <text class="option-text">1.5x</text>
            </view>
            <view class="option-btn {{playbackRate === 1.75 ? 'selected' : ''}}" bindtap="setPlaybackRate" data-rate="1.75">
              <text class="option-text">1.75x</text>
            </view>
          </view>
        </view>

        <!-- å­—ä½“å¤§å°é€‰é¡¹ -->
        <view wx:if="{{activePanel === 'fontSize'}}" class="panel-content active">
          <view class="panel-header">é€‰æ‹©å­—ä½“å¤§å°</view>
          <view class="size-options">
            <view class="size-option {{fontSize === 'small' ? 'selected' : ''}}" bindtap="setFontSize" data-size="small">
              <text class="size-text">å°</text>
            </view>
            <view class="size-option {{fontSize === 'medium' ? 'selected' : ''}}" bindtap="setFontSize" data-size="medium">
              <text class="size-text">ä¸­</text>
            </view>
            <view class="size-option {{fontSize === 'large' ? 'selected' : ''}}" bindtap="setFontSize" data-size="large">
              <text class="size-text">å¤§</text>
            </view>
          </view>
        </view>

        <!-- å­—ä½“é¢œè‰²é€‰é¡¹ -->
        <view wx:if="{{activePanel === 'fontColor'}}" class="panel-content active">
          <view class="panel-header">é€‰æ‹©å­—ä½“é¢œè‰²</view>
          <view class="color-options">
            <view class="color-option {{fontColor === 'black' ? 'selected' : ''}}" bindtap="setFontColor" data-color="black">
              <view class="color-swatch black"></view>
              <text class="color-label">é»‘è‰²</text>
            </view>
            <view class="color-option {{fontColor === 'white' ? 'selected' : ''}}" bindtap="setFontColor" data-color="white">
              <view class="color-swatch white"></view>
              <text class="color-label">ç™½è‰²</text>
            </view>
            <view class="color-option {{fontColor === 'green' ? 'selected' : ''}}" bindtap="setFontColor" data-color="green">
              <view class="color-swatch green"></view>
              <text class="color-label">ç»¿è‰²</text>
            </view>
            <view class="color-option {{fontColor === 'blue' ? 'selected' : ''}}" bindtap="setFontColor" data-color="blue">
              <view class="color-swatch blue"></view>
              <text class="color-label">è“è‰²</text>
            </view>
            <view class="color-option {{fontColor === 'red' ? 'selected' : ''}}" bindtap="setFontColor" data-color="red">
              <view class="color-swatch red"></view>
              <text class="color-label">çº¢è‰²</text>
            </view>
            <view class="color-option {{fontColor === 'brown' ? 'selected' : ''}}" bindtap="setFontColor" data-color="brown">
              <view class="color-swatch brown"></view>
              <text class="color-label">æ£•è‰²</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
      <view class="mp3-controls">
        <!-- æ’­æ”¾æ§åˆ¶é¢æ¿ï¼ˆå±…ä¸­ï¼‰ -->
        <view class="control-panel">
          <!-- ç¬¬ä¸€è¡Œï¼šè£…é¥°å’Œä¸‹è½½æŒ‰é’® -->
          <view class="control-row">
            <view class="control-btn decoration-btn">
              <image class="decoration-icon" src="/assets/images/è£…é¥°.png" mode="aspectFit"></image>
            </view>
            <view class="control-btn download-btn" bindtap="downloadSong">
              <image class="control-icon-img" src="/assets/images/ä¸‹è½½.png" mode="aspectFit"></image>
            </view>
          </view>

          <!-- ç¬¬äºŒè¡Œï¼šå››ä¸ªæŒ‰é’® -->
          <view class="control-row">
            <view class="control-btn prev-btn" bindtap="prevSong">
              <image class="control-icon-img" src="/assets/images/å€’å¸¦.png" mode="aspectFit"></image>
            </view>
            <view class="control-btn play-btn main-btn" bindtap="togglePlay">
              <image class="control-icon-img" src="{{isPlaying ? '/assets/images/stop.png' : '/assets/images/play.png'}}" mode="aspectFit"></image>
            </view>
            <view class="control-btn mode-btn main-btn" bindtap="cyclePlayMode">
              <image class="control-icon-img" src="{{playMode === 'list' ? '/assets/images/åˆ—è¡¨å¾ªç¯.png' : playMode === 'single' ? '/assets/images/å•æ›²å¾ªç¯.png' : '/assets/images/éšæœºæ’­æ”¾.png'}}" mode="aspectFit"></image>
            </view>
            <view class="control-btn next-btn" bindtap="nextSong">
              <image class="control-icon-img" src="/assets/images/å¿«è¿›.png" mode="aspectFit"></image>
            </view>
          </view>

          <!-- ç¬¬ä¸‰è¡Œï¼šæ”¶è—æŒ‰é’®å’Œæ’­æ”¾åˆ—è¡¨æŒ‰é’® -->
          <view class="control-row">
            <view class="control-btn favorite-btn" bindtap="toggleFavorite">
              <image class="control-icon-img" src="{{isFavorite ? '/assets/images/ç‚¹å‡»å–œæ¬¢å.png' : '/assets/images/å–œæ¬¢æŒ‰é’®åŸå§‹çŠ¶æ€.png'}}" mode="aspectFit"></image>
            </view>
            <view class="control-btn playlist-btn" bindtap="togglePlaylist">
              <image class="control-icon-img" src="/assets/images/æ’­æ”¾åˆ—è¡¨.png" mode="aspectFit"></image>
            </view>
          </view>
        </view>
      </view>

      <!-- MP3å“ç‰Œæ ‡è¯† -->
      <view class="mp3-brand">
        <text class="brand-text">å¤æ—¥éšèº«å¬</text>
        <text class="brand-subtitle">Summer MP3 Player</text>
      </view>
    </view>
    </view>

  <!-- æ­Œæ›²åˆ—è¡¨ -->
  <view class="playlist-panel {{showPlaylist ? 'visible' : ''}}">
    <view class="playlist-header">
      <text class="playlist-title">æ’­æ”¾åˆ—è¡¨</text>
      <view class="close-playlist" bindtap="togglePlaylist">âœ•</view>
    </view>
    <scroll-view class="playlist-scroll" scroll-y="true">
      <view class="song-item {{index === currentSongIndex ? 'playing' : ''}}"
            wx:for="{{playlist}}"
            wx:key="index"
            bindtap="selectSong"
            data-index="{{index}}">
        <view class="song-number">{{index + 1}}</view>
        <view class="song-details">
          <text class="item-title">{{item.title}}</text>
          <text class="item-artist">{{item.artist}}</text>
        </view>
        <view class="song-favorite">
          <text class="favorite-icon">{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        </view>
        <view class="song-duration">{{item.duration}}</view>
      </view>
    </scroll-view>
  </view>

</view>
