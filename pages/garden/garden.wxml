<!-- pages/hoofprint/hoofprint.wxml -->
<view class="page">
  <image class="page-bg" src="/assets/images/splash-bg.png" mode="aspectFill" />

  <!-- 上边空白：分组、留白、主次分明 -->
  <view class="edge-top">
    <view class="edge-top-inner">
      <view class="edge-btns">
        <view class="edge-btn-item" bindtap="onTapGuide">
          <text class="edge-btn-icon">🌿</text>
          <text class="edge-btn-text">放松攻略</text>
        </view>
        <view class="edge-btn-item" bindtap="onTapBgMusic">
          <text class="edge-btn-icon">♪</text>
          <text class="edge-btn-text">背景声音</text>
        </view>
      </view>
      <view class="edge-live">
        <text class="edge-live-num">{{liveWatchCount}}</text>
        <text class="edge-live-text">人正在这里歇脚</text>
      </view>
    </view>
  </view>

  <view class="frame-bg">
    <video
      wx:if="{{useVideoBg}}"
      class="frame-bg2"
      src="{{frameVideoSrc}}"
      autoplay
      loop
      muted
      show-center-play-btn="false"
      controls="false"
      objectFit="cover"
    ></video>
    <image wx:else class="frame-bg2" src="{{bg2ImageUrl}}" mode="aspectFill" />
    <view class="frame-bg-quote-wrap" wx:if="{{bgQuoteLines.length}}">
      <view class="frame-bg-quote-line"></view>
      <text class="frame-bg-quote" wx:for="{{bgQuoteLines}}" wx:key="index">{{item}}</text>
      <view class="frame-bg-quote-line-bottom"></view>
    </view>
  </view>
  <!-- 坐下途中切出：小羊离开提示 -->
  <view class="away-notice-mask" wx:if="{{showAwayNotice}}" catchtap="onDismissAwayNotice">
    <view class="away-notice-card">
      <text class="away-notice-text">你的伙伴夏小咩已经离开，但是可以作为音频后台运行。</text>
    </view>
  </view>
  <view
    class="bench-wrap"
    wx:if="{{!showAwayNotice}}"
    style="left: {{benchX}}px; top: {{benchY}}px; transform: translate(-50%, -50%) scale({{benchScale}});"
    bindtouchstart="onBenchTouchStart"
    catchtouchmove="onBenchTouchMove"
    bindtouchend="onBenchTouchEnd"
  >
    <view class="bench-hint" wx:if="{{showBenchHint}}">可以自由拖动我的位置以及调整我的大小哦～</view>
    <image class="bench-img" src="{{benchImageUrl}}" mode="aspectFit" />
  </view>

  <!-- 下边空白：坐下倒计时居中 + 两枚主入口 -->
  <view class="edge-bottom">
    <view class="edge-countdown-wrap edge-countdown-center">
      <picker mode="selector" range="{{sitMinutesOptions}}" value="{{sitMinutesIndex}}" bindchange="onSitMinutesChange">
        <view class="edge-sit-row edge-sit-picker-trigger">
          <text class="edge-countdown-label">坐下</text>
          <view class="edge-sit-mins-wrap"><text class="edge-sit-mins">{{sitMinutes}} 分钟</text><text class="edge-sit-arrow">▼</text></view>
        </view>
      </picker>
      <view class="edge-sit-row edge-sit-start" bindtap="onTapSitCountdown">
        <text class="edge-countdown-value" wx:if="{{sitCountdown}}">{{sitCountdown}}</text>
        <text class="edge-countdown-value" wx:else>开始</text>
      </view>
    </view>
    <view class="edge-bottom-cards">
      <view class="edge-card edge-card-museum" bindtap="onTapMuseum">
        <text class="edge-card-title">夏日时光机</text>
      </view>
      <view class="edge-card edge-card-flick" bindtap="onTapShop">
        <text class="edge-card-title">绵羊杂货铺</text>
      </view>
    </view>
  </view>

  <!-- 攻略弹窗 -->
  <view class="guide-mask" wx:if="{{showGuideModal}}" catchtap="onCloseGuideModal">
    <view class="guide-modal" catchtap="">
      <swiper wx:if="{{guideImages.length > 0}}" class="guide-swiper" 
              indicator-dots="{{guideImages.length > 1}}" 
              autoplay="{{false}}" 
              circular="{{false}}" 
              bindchange="onGuideSwiperChange"
              current="{{currentGuideImageIndex}}"
              duration="300"
              easing-function="default"
              skip-hidden-item-layout="{{true}}">
        <swiper-item wx:for="{{guideImages}}" wx:key="*this">
          <view class="guide-image-wrapper">
            <image class="guide-image" src="{{item}}" mode="aspectFit" lazy-load="{{true}}" />
          </view>
        </swiper-item>
      </swiper>
      <view wx:else class="guide-no-images">
        <text class="guide-no-images-text">正在加载攻略图片...</text>
      </view>
      <view class="guide-close" bindtap="onCloseGuideModal">×</view>
    </view>
  </view>

  <!-- 烦恼橡皮擦：输入模态框 -->
  <view class="worry-modal-mask" wx:if="{{showWorryModal}}" bindtap="closeWorryModal">
    <view class="worry-modal-content" catchtap="stopProp">
      <image class="worry-modal-bg" src="/assets/images/splash-bg.png" mode="aspectFill" />
      <view class="worry-modal-body">
        <view class="worry-modal-title">把烦恼告诉小绵羊</view>
        <textarea class="worry-input" placeholder="在这里写下你的烦恼..." bindinput="onWorryInput" value="{{worryText}}" maxlength="50"></textarea>
        <view class="worry-modal-btn" bindtap="submitWorry">一 起 弹 走 烦 恼 吧</view>
      </view>
    </view>
  </view>

  <!-- 烦恼橡皮擦：动画层 -->
  <view class="worry-animation-layer" wx:if="{{isAnimating}}">
    <view class="running-sheep-container">
      <image class="running-sheep-image" src="/assets/images/小绵羊.png" mode="aspectFit" />
    </view>
    <view wx:for="{{fallingChars}}" wx:key="index" class="falling-char" style="left:{{item.left}}%; font-size:{{item.size}}rpx; animation-duration:{{item.duration}}s; animation-delay:{{item.delay}}s; --bounce-dir:{{item.bounceDir}};">
      {{item.char}}
    </view>
    <view class="encouraging-text" wx:if="{{showEncouragingText}}">{{encouragingText}}</view>
    <view class="close-animation-btn" bindtap="closeAnimation">×</view>
  </view>

  <!-- 坐下10分钟完成：接力鼓励弹层（文艺治愈水彩风） -->
  <view class="relay-mask" wx:if="{{relayModalVisible}}" catchtap="onCloseRelayModal">
    <view class="relay-card" catchtap="">
      <view class="relay-card-inner">
        <text class="relay-label">上一位在这里歇脚的人留给你</text>
        <text class="relay-message">{{relayMessage}}</text>
        <text class="relay-label relay-label-write">写一句话给后面的人</text>
        <textarea
          class="relay-input"
          placeholder="在这里写下你的鼓励～"
          value="{{relayInputText}}"
          bindinput="onRelayInput"
          maxlength="120"
        />
        <view class="relay-actions">
          <view class="relay-btn relay-btn-submit" bindtap="onRelaySubmit">保留给自己并传给下一位</view>
        </view>
      </view>
    </view>
  </view>
</view>